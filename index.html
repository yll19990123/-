<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ren Nagase ä¸“å±è½¨è¿¹å›¾é‰´</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #fdfdfd; color: #333; }
        .controls { margin-bottom: 30px; background: #fff; padding: 20px; border-radius: 15px; display: inline-block; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        select, button { padding: 12px; margin: 5px; border-radius: 8px; border: 1px solid #eee; font-size: 15px; cursor: pointer; }
        button { background: #000; color: white; border: none; }
        button:hover { background: #333; }
        .gallery { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }
        .photo-card { background: white; padding: 10px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); position: relative; }
        img { width: 280px; height: auto; border-radius: 8px; display: block; }
        .check-container { margin-top: 10px; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .owner-badge { background: #ffdee9; color: #b83b5e; padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body>
    <h1>ğŸ–¤ Ren Nagase ä¸ªäººå›¾é‰´æ”¶è—</h1>
    
    <div class="controls">
        <select id="yearSelect"><option value="">åŠ è½½ä¸­...</option></select>
        <select id="singleSelect"><option value="">é€‰æ‹©åˆ†ç±»</option></select>
        <button onclick="showMyCollection()">æŸ¥çœ‹æˆ‘çš„æ”¶è—å•</button>
        <button onclick="location.reload()" style="background:#eee; color:#333;">æ˜¾ç¤ºå…¨éƒ¨</button>
    </div>

    <div id="statusInfo" style="margin-bottom: 10px; font-weight: bold;"></div>
    <div class="gallery" id="gallery"></div>

    <script>
        let photoData = {};
        // ä»æµè§ˆå™¨æœ¬åœ°è¯»å–å·²ç»å‹¾é€‰çš„ç…§ç‰‡åˆ—è¡¨ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„
        let myCollection = JSON.parse(localStorage.getItem('nagaseren_favs')) || [];

        const yearSelect = document.getElementById('yearSelect');
        const singleSelect = document.getElementById('singleSelect');
        const gallery = document.getElementById('gallery');
        const statusInfo = document.getElementById('statusInfo');

        fetch('data.json?t=' + new Date().getTime())
            .then(res => res.json())
            .then(data => {
                photoData = data;
                yearSelect.innerHTML = '<option value="">é€‰æ‹©å¹´ä»½</option>';
                Object.keys(data).sort((a, b) => b - a).forEach(year => {
                    yearSelect.appendChild(new Option(year + "å¹´", year));
                });
            });

        function renderGallery(photos, isCollectionMode = false) {
            gallery.innerHTML = '';
            if (photos.length === 0) {
                gallery.innerHTML = '<p>è¿™é‡Œè¿˜æ²¡æœ‰ç…§ç‰‡å“¦~</p>';
                return;
            }
            photos.forEach(url => {
                const card = document.createElement('div');
                card.className = 'photo-card';
                
                // å¦‚æœæ˜¯æ”¶è—æ¨¡å¼ï¼ŒåŠ ä¸ªå°å‹‹ç« 
                if (myCollection.includes(url)) {
                    card.innerHTML += '<span class="owner-badge">å·²å…¥åº“</span>';
                }

                const img = document.createElement('img');
                img.src = url;
                img.onerror = () => { img.src = 'https://via.placeholder.com/280?text=å›¾ç‰‡æš‚æœªä¸Šä¼ '; };
                
                const checkDiv = document.createElement('div');
                checkDiv.className = 'check-container';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = myCollection.includes(url);
                
                checkbox.onchange = function() {
                    if (this.checked) {
                        if (!myCollection.includes(url)) myCollection.push(url);
                    } else {
                        myCollection = myCollection.filter(item => item !== url);
                    }
                    // å°†æ›´æ–°åçš„åˆ—è¡¨ä¿å­˜åˆ°æµè§ˆå™¨
                    localStorage.setItem('nagaseren_favs', JSON.stringify(myCollection));
                    updateStatus();
                };

                const label = document.createElement('label');
                label.innerText = 'åŠ å…¥æˆ‘çš„å›¾é‰´';
                
                checkDiv.appendChild(checkbox);
                checkDiv.appendChild(label);
                card.appendChild(img);
                card.appendChild(checkDiv);
                gallery.appendChild(card);
            });
        }

        yearSelect.onchange = function() {
            singleSelect.innerHTML = '<option value="">é€‰æ‹©åˆ†ç±»</option>';
            if (this.value && photoData[this.value]) {
                Object.keys(photoData[this.value]).forEach(single => {
                    singleSelect.appendChild(new Option(single, single));
                });
            }
        };

        singleSelect.onchange = function() {
            if (this.value && yearSelect.value) {
                renderGallery(photoData[yearSelect.value][this.value]);
            }
        };

        function showMyCollection() {
            statusInfo.innerText = "æ­£åœ¨å±•ç¤ºä½ çš„ä¸“å±ä¸ªäººå›¾é‰´ï¼ˆå…± " + myCollection.length + " å¼ ï¼‰";
            renderGallery(myCollection, true);
        }

        function updateStatus() {
            if (statusInfo.innerText.includes("ä¸“å±ä¸ªäººå›¾é‰´")) {
                showMyCollection();
            }
        }
    </script>
</body>
</html>
